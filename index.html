<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onbora - Help New Hires Belong from Day One</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
        .chat-message { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>
    <div id="app">
        <!-- Landing Page -->
        <div id="landing" class="min-h-screen bg-white">
            <nav class="flex justify-between items-center px-8 py-6 border-b border-gray-100">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">O</span>
                    </div>
                    <span class="text-xl font-bold">Onbora</span>
                </div>
                <div class="flex items-center space-x-8">
                    <button class="text-gray-600 hover:text-black transition">Features</button>
                    <button class="text-gray-600 hover:text-black transition">How it Works</button>
                    <button class="text-gray-600 hover:text-black transition">Pricing</button>
                    <button 
                        onclick="showView('setup')"
                        class="bg-black text-white px-6 py-2.5 rounded-full hover:bg-gray-800 transition"
                    >
                        Get Started
                    </button>
                </div>
            </nav>

            <section class="max-w-6xl mx-auto px-8 py-20 text-center">
                <div class="animate-fade-in">
                    <h1 class="text-7xl font-bold leading-tight mb-6">
                        Help New Hires<br />
                        Belong from Day One
                    </h1>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto mb-8">
                        Create personalized onboarding experiences that make every new employee 
                        feel welcomed, informed, and ready to contribute‚Äîwithout endless prep work for you.
                    </p>
                    <div class="flex justify-center space-x-4">
                        <button 
                            onclick="showView('setup')"
                            class="bg-black text-white px-8 py-4 rounded-full text-lg hover:bg-gray-800 transition"
                        >
                            Start Free Trial
                        </button>
                        <button 
                            onclick="showView('employee')"
                            class="border-2 border-black text-black px-8 py-4 rounded-full text-lg hover:bg-gray-50 transition"
                        >
                            See Demo
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Setup Page -->
        <div id="setup" class="hidden min-h-screen bg-gray-50">
            <nav class="bg-white border-b border-gray-200 px-8 py-4">
                <div class="flex justify-between items-center">
                    <div 
                        class="flex items-center space-x-2 cursor-pointer"
                        onclick="showView('landing')"
                    >
                        <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">O</span>
                        </div>
                        <span class="text-xl font-bold">Onbora</span>
                    </div>
                    <button 
                        onclick="showView('landing')"
                        class="text-gray-600 hover:text-black transition text-2xl"
                    >
                        √ó
                    </button>
                </div>
            </nav>

            <div class="max-w-4xl mx-auto px-8 py-12">
                <div class="text-center mb-12">
                    <h1 class="text-4xl font-bold mb-4">Let's get your company set up</h1>
                    <p class="text-xl text-gray-600">
                        This will take about 5 minutes. We'll capture your company info and culture.
                    </p>
                </div>

                <!-- Step 1: Company Info -->
                <div id="step1" class="bg-white rounded-3xl p-8 shadow-sm mb-6">
                    <h2 class="text-2xl font-bold mb-6">Company Information</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                            <input type="text" id="companyName" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-black" placeholder="Your Company">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Company Size</label>
                            <select id="companySize" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-black">
                                <option value="">Select size</option>
                                <option value="1-10">1-10 employees</option>
                                <option value="11-50">11-50 employees</option>
                                <option value="51-200">51-200 employees</option>
                                <option value="201-1000">201-1000 employees</option>
                                <option value="1000+">1000+ employees</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Industry</label>
                            <input type="text" id="companyIndustry" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-black" placeholder="e.g., Technology, Healthcare">
                        </div>
                    </div>
                    <div class="mt-6 text-right">
                        <button 
                            onclick="nextStep(2)"
                            class="bg-black text-white px-6 py-3 rounded-xl hover:bg-gray-800 transition"
                        >
                            Continue
                        </button>
                    </div>
                </div>

                <!-- Step 2: Documents -->
                <div id="step2" class="hidden bg-white rounded-3xl p-8 shadow-sm mb-6">
                    <h2 class="text-2xl font-bold mb-6">Company Documents</h2>
                    <p class="text-gray-600 mb-6">
                        Upload your employee handbook, policies, or any other documents that new hires should know about. (e.g., .txt, .md, .pdf)
                    </p>
                    
                    <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer transition hover:bg-gray-50">
                        <div class="text-4xl mb-4">üìÑ</div>
                        <p class="text-gray-600 mb-2">Drag & drop files here, or click to browse</p>
                        <p class="text-sm text-gray-500">AI will analyze text-based files to fuel the interview.</p>
                        <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt,.md" class="hidden">
                    </div>

                    <div id="fileList" class="mt-4 space-y-2"></div>
                    
                    <div class="mt-6 flex justify-between">
                        <button 
                            onclick="prevStep(1)"
                            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition"
                        >
                            Back
                        </button>
                        <button 
                            onclick="nextStep(3)"
                            class="bg-black text-white px-6 py-3 rounded-xl hover:bg-gray-800 transition"
                        >
                            Continue
                        </button>
                    </div>
                </div>

                <!-- Step 3: Culture Interview -->
                <div id="step3" class="hidden bg-white rounded-3xl p-8 shadow-sm mb-6">
                    <h2 class="text-2xl font-bold mb-6">Let's capture your culture</h2>
                    <p class="text-gray-600 mb-8">
                        I'll analyze your documents first, then have a quick conversation to fill in any gaps. 
                        This usually takes about 2-3 minutes.
                    </p>
                    
                    <!-- Document Analysis Step -->
                    <div id="documentAnalysis" class="bg-blue-50 border border-blue-200 rounded-2xl p-6 mb-6">
                        <div class="text-center">
                            <div class="text-3xl mb-4">üîç</div>
                            <h3 class="text-lg font-semibold text-blue-800 mb-2">Analyzing Your Documents</h3>
                            <p class="text-blue-700 mb-4">AI is reading through your company documents to understand your culture</p>
                            <div class="flex items-center justify-center space-x-2">
                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="interview" class="bg-gray-50 rounded-2xl p-6 hidden">
                        <div id="interviewMessages" class="mb-4 space-y-4 max-h-96 overflow-y-auto">
                            <!-- Interview messages will appear here -->
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex space-x-3">
                                <input
                                    type="text"
                                    id="interviewInput"
                                    class="flex-1 px-4 py-2.5 border border-gray-200 rounded-xl focus:outline-none focus:border-black"
                                    placeholder="Type your answer here..."
                                    onkeypress="if(event.key==='Enter') submitInterview()"
                                >
                                <button 
                                    onclick="submitInterview()"
                                    class="bg-black text-white px-5 py-2.5 rounded-xl hover:bg-gray-800 transition"
                                >
                                    Send
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Interview Summary (shown after completion) -->
                    <div id="interviewSummary" class="hidden mt-6 bg-green-50 border border-green-200 rounded-2xl p-6">
                        <div class="text-center mb-6">
                            <div class="text-4xl mb-4">üéâ</div>
                            <h3 class="text-2xl font-bold mb-2">Interview Complete!</h3>
                            <p class="text-gray-600">Great! I've captured your company culture. Here's a summary:</p>
                        </div>
                        
                        <div id="summaryContent" class="space-y-4 mb-6">
                            <!-- Summary will be populated here -->
                        </div>
                        
                        <div class="text-center">
                            <button 
                                onclick="showView('employee')"
                                class="bg-black text-white px-6 py-3 rounded-xl hover:bg-gray-800 transition"
                            >
                                Preview Your Agents
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employee Experience Page (Full UI with all agents) -->
        <div id="employee" class="hidden min-h-screen bg-gray-50">
            <nav class="bg-white border-b border-gray-200 px-8 py-4">
                <div class="flex justify-between items-center">
                    <div 
                        class="flex items-center space-x-2 cursor-pointer"
                        onclick="showView('landing')"
                    >
                        <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">O</span>
                        </div>
                        <span class="text-xl font-bold">Onbora</span>
                    </div>
                    <button 
                        onclick="showView('landing')"
                        class="text-gray-600 hover:text-black transition text-2xl"
                    >
                        √ó
                    </button>
                </div>
            </nav>

            <div class="flex h-screen pt-16">
                <!-- Left Sidebar - Agent Selection -->
                <div class="w-80 bg-white border-r border-gray-200 p-6 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-6">Your AI Team</h2>
                    
                    <!-- AI Status Indicator -->
                    <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-xl">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm font-medium text-green-800">AI Service Active</span>
                        </div>
                        <p class="text-xs text-green-700">
                            Powered by Google Gemini ‚Ä¢ Company context loaded ‚Ä¢ Documents analyzed
                        </p>
                    </div>
                    
                    <div class="space-y-3">
                        <div 
                            onclick="selectAgent('maya')"
                            class="agent-item p-4 rounded-xl cursor-pointer hover:bg-gray-50 transition"
                            data-agent="maya"
                        >
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">üëã</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold">Maya</h3>
                                    <p class="text-sm text-gray-600">Welcome Guide</p>
                                    <p class="text-xs text-blue-600">AI-powered responses</p>
                                </div>
                            </div>
                        </div>
                        <div 
                            onclick="selectAgent('alex')"
                            class="agent-item p-4 rounded-xl cursor-pointer hover:bg-gray-50 transition"
                            data-agent="alex"
                        >
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">üìã</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold">Alex</h3>
                                    <p class="text-sm text-gray-600">HR Assistant</p>
                                    <p class="text-xs text-blue-600">AI-powered responses</p>
                                </div>
                            </div>
                        </div>
                        <div 
                            onclick="selectAgent('jordan')"
                            class="agent-item p-4 rounded-xl cursor-pointer hover:bg-gray-50 transition"
                            data-agent="jordan"
                        >
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">üéØ</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold">Jordan</h3>
                                    <p class="text-sm text-gray-600">Culture Guide</p>
                                    <p class="text-xs text-blue-600">AI-powered responses</p>
                                </div>
                            </div>
                        </div>
                        <div 
                            onclick="selectAgent('sam')"
                            class="agent-item p-4 rounded-xl cursor-pointer hover:bg-gray-50 transition"
                            data-agent="sam"
                        >
                            <div class="flex items-center space-x-3">
                                <div class="text-2xl">üíª</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold">Sam</h3>
                                    <p class="text-sm text-gray-600">Tech Setup</p>
                                    <p class="text-xs text-blue-600">AI-powered responses</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Checklist Section -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold mb-4">Onboarding Checklist</h3>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="check1" class="w-4 h-4 rounded border-gray-300 text-black focus:ring-black">
                                <label for="check1" class="text-sm text-gray-700">Complete office tour</label>
                            </div>
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="check2" class="w-4 h-4 rounded border-gray-300 text-black focus:ring-black">
                                <label for="check2" class="text-sm text-gray-700">Set up workspace</label>
                            </div>
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="check3" class="w-4 h-4 rounded border-gray-300 text-black focus:ring-black">
                                <label for="check3" class="text-sm text-gray-700">Meet team members</label>
                            </div>
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="check4" class="w-4 h-4 rounded border-gray-300 text-black focus:ring-black">
                                <label for="check4" class="text-sm text-gray-700">Review handbook</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Chat Area -->
                <div class="flex-1 flex flex-col">
                    <!-- Chat Header -->
                    <div class="bg-white border-b border-gray-200 p-6">
                        <div class="flex items-center space-x-4">
                            <div id="currentAgentAvatar" class="text-3xl">üëã</div>
                            <div>
                                <h2 id="currentAgentName" class="text-2xl font-bold">Maya</h2>
                                <p id="currentAgentRole" class="text-gray-600">Welcome Guide</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div class="flex-1 bg-gray-50 p-6 overflow-y-auto">
                        <div id="chatMessages" class="space-y-4">
                            <div class="flex justify-start">
                                <div class="max-w-lg">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="text-sm font-medium">Maya</span>
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-800">Welcome Guide</span>
                                    </div>
                                    <div class="bg-white border border-gray-200 rounded-2xl px-4 py-3 mr-12">
                                        <p class="text-gray-800">
                                            Hi! I'm Maya, your welcome guide. I'm here to help you get settled in on your first day! 
                                            What would you like to know about getting started?
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="bg-white border-t border-gray-200 p-6">
                        <div class="flex space-x-3">
                            <input
                                type="text"
                                id="chatInput"
                                class="flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-black"
                                placeholder="Ask anything..."
                                onkeypress="if(event.key==='Enter') sendMessage()"
                            >
                            <button 
                                onclick="sendMessage()"
                                class="bg-black text-white px-6 py-3 rounded-xl hover:bg-gray-800 transition"
                            >
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentStep = 1;
        let uploadedFileContents = [];
        let currentAgent = 'maya';
        let interviewQuestionIndex = 0;

        const interviewQuestions = [
            "That's great! Now, what are the core values that drive your team? What principles guide how you work together?",
            "Perfect! What should new employees know about your work style? Are you more collaborative or independent? Fast-paced or methodical?",
            "Excellent insights! What are the most important things a new hire should accomplish in their first day?",
            "Very helpful! How about the first week - what key milestones should they hit?",
            "Almost done! What unique traditions, perks, or aspects of your company would make new hires excited to join?",
            "Last question - what's the one piece of advice you'd give to someone starting at your company tomorrow?",
            "Thank you so much! I've captured everything I need to create a personalized onboarding experience for your new hires."
        ];

        const agents = {
            maya: { 
                name: 'Maya', 
                role: 'Welcome Guide', 
                avatar: 'üëã',
                greeting: "Hi! I'm Maya, your welcome guide. I'm here to help you get settled in on your first day! What would you like to know about getting started?"
            },
            alex: { 
                name: 'Alex', 
                role: 'HR Assistant', 
                avatar: 'üìã',
                greeting: "Hello! I'm Alex from HR. I can help you with benefits, policies, and all the administrative stuff. What do you need help with?"
            },
            jordan: { 
                name: 'Jordan', 
                role: 'Culture Guide', 
                avatar: 'üéØ',
                greeting: "Hey there! I'm Jordan, your culture guide. Let me tell you about how we do things here! What would you like to know about our culture?"
            },
            sam: { 
                name: 'Sam', 
                role: 'Tech Setup', 
                avatar: 'üíª',
                greeting: "Hi! I'm Sam from IT. I'll help you get all your tools and accounts set up. What tech setup do you need help with?"
            }
        };

        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('#landing, #setup, #employee').forEach(el => {
                if (el) el.classList.add('hidden');
            });
            
            // Show the requested view
            const view = document.getElementById(viewName);
            if (view) {
                view.classList.remove('hidden');
            }

            // Reset interview if going back to setup
            if (viewName === 'setup') {
                resetInterview();
            }
        }

        function nextStep(step) {
            if (step === 2) {
                const companyName = document.getElementById('companyName').value;
                if (!companyName.trim()) {
                    alert('Please enter your company name');
                    return;
                }
            }
            
            if (step === 3) {
                startDocumentAnalysis();
            }
            
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            document.getElementById(`step${step}`).classList.remove('hidden');
            currentStep = step;
        }

        async function startDocumentAnalysis() {
            const documentAnalysis = document.getElementById('documentAnalysis');
            const interview = document.getElementById('interview');
            
            console.log('Starting document analysis...');
            console.log('Uploaded files:', uploadedFileContents.map(f => f.name));
            
            // Show analysis in progress
            documentAnalysis.classList.remove('hidden');
            interview.classList.add('hidden');
            
            try {
                // Analyze uploaded documents if any
                let documentInsights = {};
                if (uploadedFileContents.length > 0) {
                    console.log('Analyzing documents with AI...');
                    documentInsights = await analyzeDocuments();
                    console.log('Document insights:', documentInsights);
                } else {
                    console.log('No documents uploaded, using default insights');
                    documentInsights = {
                        values: "Needs: company culture description",
                        policies: "Needs: work policies and procedures",
                        structure: "Needs: company structure details",
                        industry: "Needs: industry and business focus",
                        benefits: "Needs: employee benefits information",
                        traditions: "Needs: company traditions and unique aspects"
                    };
                }
                
                // Store insights for the interview
                window.documentInsights = documentInsights;
                
                // Show analysis complete
                setTimeout(() => {
                    documentAnalysis.innerHTML = `
                        <div class="text-center">
                            <div class="text-3xl mb-4">‚úÖ</div>
                            <h3 class="text-lg font-semibold text-green-800 mb-2">Documents Analyzed!</h3>
                            <p class="text-green-700 mb-4">AI found ${Object.keys(documentInsights).length} key insights about your company</p>
                            <button onclick="startSmartInterview()" class="bg-green-600 text-white px-6 py-2 rounded-xl hover:bg-green-700 transition">
                                Start Smart Interview
                            </button>
                        </div>
                    `;
                }, 2000);
                
            } catch (error) {
                console.error('Document analysis error:', error);
                // Fallback to manual interview
                startSmartInterview();
            }
        }

        async function analyzeDocuments() {
            try {
                // Simulate document analysis with AI
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: `Analyze these company documents and extract key information about:
                        1. Company values and culture
                        2. Work policies and procedures
                        3. Company structure and size
                        4. Industry and business focus
                        5. Employee benefits and perks
                        6. Company traditions or unique aspects
                        
                        Documents provided (names and optional partial contents):
                        ${uploadedFileContents.map(d => `- ${d.name}${d.content ? `\nContent (may be truncated):\n${d.content}` : ' (content not readable in browser)'}`).join('\n')}
                        
                        Return a JSON object with these categories and what you found. If information is missing or unclear, mark it as "needs_clarification".
                        
                        Example format:
                        {
                            "values": "Found: collaborative, innovative | Needs: specific examples",
                            "policies": "Found: remote work policy | Needs: dress code, work hours",
                            "structure": "Found: 50 employees | Needs: organizational chart",
                            "industry": "Found: technology, SaaS | Needs: none",
                            "benefits": "Found: health insurance | Needs: 401k, PTO details",
                            "traditions": "Needs: company events, team building activities"
                        }`,
                        maxTokens: 500
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Try to parse JSON response, fallback to empty object if parsing fails
                try {
                    return JSON.parse(data.response);
                } catch (parseError) {
                    console.log('Could not parse AI response as JSON, using fallback');
                    return {
                        values: "Needs: company culture description",
                        policies: "Needs: work policies and procedures",
                        structure: "Needs: company structure details",
                        industry: "Needs: industry and business focus",
                        benefits: "Needs: employee benefits information",
                        traditions: "Needs: company traditions and unique aspects"
                    };
                }
                
            } catch (error) {
                console.error('Error analyzing documents:', error);
                // Return default structure if AI analysis fails
                return {
                    values: "Needs: company culture description",
                    policies: "Needs: work policies and procedures",
                    structure: "Needs: company structure details",
                    industry: "Needs: industry and business focus",
                    benefits: "Needs: employee benefits information",
                    traditions: "Needs: company traditions and unique aspects"
                };
            }
        }

        function startSmartInterview() {
            const documentAnalysis = document.getElementById('documentAnalysis');
            const interview = document.getElementById('interview');
            
            // Hide analysis, show interview
            documentAnalysis.classList.add('hidden');
            interview.classList.remove('hidden');
            
            // Initialize interview with smart first question
            initializeSmartInterview();
        }

        function initializeSmartInterview() {
            const documentInsights = window.documentInsights || {};
            const interviewMessages = document.getElementById('interviewMessages');
            
            // Clear any existing messages
            interviewMessages.innerHTML = '';
            
            // Find the most important gap to focus on
            let priorityGap = null;
            if (documentInsights.values && documentInsights.values.includes('Needs:')) {
                priorityGap = 'values';
            } else if (documentInsights.policies && documentInsights.policies.includes('Needs:')) {
                priorityGap = 'policies';
            } else if (documentInsights.traditions && documentInsights.traditions.includes('Needs:')) {
                priorityGap = 'traditions';
            }
            
            // Generate smart first question based on document analysis
            let firstQuestion = "Welcome! I've analyzed your documents and have a good understanding of your company. ";
            
            if (priorityGap === 'values') {
                firstQuestion += "I'd love to hear about your company culture and values. ";
                firstQuestion += "What would you say makes your workplace special?";
            } else if (priorityGap === 'policies') {
                firstQuestion += "I found some of your work policies. ";
                firstQuestion += "What's the most important thing new employees should know about how you work?";
            } else if (priorityGap === 'traditions') {
                firstQuestion += "I can see your company structure and policies. ";
                firstQuestion += "What traditions or unique aspects make your company culture special?";
            } else {
                firstQuestion += "Let's start with something simple - how would you describe your company culture in a few words?";
            }
            
            // Add AI greeting
            addInterviewMessage(firstQuestion, false);
            
            // Reset interview state
            interviewQuestionIndex = 0;
            window.interviewAnswers = [];
        }

        function prevStep(step) {
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            document.getElementById(`step${step}`).classList.remove('hidden');
            currentStep = step;
        }

        function handleFileUpload(files) {
            console.log('handleFileUpload triggered with', files.length, 'files.');
            const fileList = document.getElementById('fileList');
            
            // It's safer to overwrite than to try and sync
            uploadedFileContents = []; 
            fileList.innerHTML = '';

            if (!files || files.length === 0) {
                console.log('No files to process.');
                return;
            }

            for (const file of files) {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                fileItem.innerHTML = `
                    <div class="flex items-center space-x-2 overflow-hidden">
                        <span class="text-xl">üìÑ</span>
                        <span class="text-sm text-gray-700 truncate">${file.name}</span>
                    </div>
                    <span class="file-status text-xs text-blue-600 ml-2">Processing...</span>
                `;
                fileList.appendChild(fileItem);

                const isReadableText = file.type.startsWith('text/') || /\.(txt|md)$/i.test(file.name);
                if (isReadableText) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const content = String(e.target.result || '').slice(0, 8000);
                        uploadedFileContents.push({ name: file.name, type: file.type, content: content });
                        fileItem.querySelector('.file-status').textContent = '‚úì Ready';
                        fileItem.querySelector('.file-status').classList.replace('text-blue-600', 'text-green-600');
                        console.log('Successfully read:', file.name);
                    };
                    reader.onerror = () => {
                        console.error('Failed to read file:', file.name);
                        fileItem.querySelector('.file-status').textContent = '‚úó Error';
                        fileItem.querySelector('.file-status').classList.replace('text-blue-600', 'text-red-600');
                    };
                    reader.readAsText(file);
                } else {
                    uploadedFileContents.push({ name: file.name, type: file.type, content: `[File type (${file.type}) not readable in browser]` });
                    fileItem.querySelector('.file-status').textContent = '‚úì Added';
                    fileItem.querySelector('.file-status').classList.replace('text-blue-600', 'text-gray-500');
                    console.log('Added non-readable file:', file.name);
                }
            }
            
            document.getElementById('fileInput').value = '';
        }

        function submitInterview() {
            const input = document.getElementById('interviewInput');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addInterviewMessage(message, true);
            input.value = '';

            // Store the answer for the summary
            if (!window.interviewAnswers) window.interviewAnswers = [];
            window.interviewAnswers.push(message);

            // Show typing indicator for AI
            const typingDiv = document.createElement('div');
            typingDiv.className = 'flex justify-start chat-message';
            typingDiv.id = 'interviewTypingIndicator';
            typingDiv.innerHTML = `
                <div class="max-w-lg">
                    <div class="flex items-center space-x-2 mb-2">
                        <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                            <span>ü§ñ</span>
                        </div>
                        <span class="text-sm font-medium">AI Interviewer</span>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-2xl px-4 py-3 mr-12">
                        <p class="text-gray-800">Thinking...</p>
                    </div>
                </div>
            `;
            document.getElementById('interviewMessages').appendChild(typingDiv);
            document.getElementById('interviewMessages').scrollTop = document.getElementById('interviewMessages').scrollTop;

            // Call AI for intelligent follow-up questions
            callAIInterviewer(message);
        }

        async function callAIInterviewer(message) {
            try {
                // Remove typing indicator
                const typingIndicator = document.getElementById('interviewTypingIndicator');
                if (typingIndicator) typingIndicator.remove();

                // Get document insights and previous answers
                const documentInsights = window.documentInsights || {};
                const previousAnswers = window.interviewAnswers || [];
                
                // Prepare context for the AI interviewer
                const interviewContext = {
                    companyName: document.getElementById('companyName').value || 'Your Company',
                    companySize: document.getElementById('companySize').value || 'Not specified',
                    companyIndustry: document.getElementById('companyIndustry').value || 'Not specified',
                    previousAnswers: previousAnswers,
                    documentInsights: documentInsights,
                    currentQuestion: interviewQuestionIndex + 1,
                    totalQuestions: 7
                };

                // Create smart prompt based on what we already know
                let smartPrompt = `You are an AI interviewer helping to understand a company's culture for onboarding purposes. 
                
                Company: ${interviewContext.companyName}
                Size: ${interviewContext.companySize}
                Industry: ${interviewContext.companyIndustry}
                
                Previous answers: ${previousAnswers.join(', ')}
                
                Document insights already found: ${JSON.stringify(documentInsights)}
                
                Current question: ${interviewContext.currentQuestion} of 3
                
                The user just answered: "${message}"
                
                IMPORTANT: Based on the document insights and previous answers, ask the next intelligent question that:
                1. DOES NOT ask about information already found in documents
                2. Builds on what they've shared
                3. Focuses on gaps or unclear areas
                4. Feels natural and conversational
                
                You only have 3 questions total, so make each one count! Focus on the most important aspects that aren't already covered in documents.
                
                If this is the last question (question 3), thank them and say the interview is complete.
                
                Keep your response under 80 words and make it feel natural and engaging.`;

                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: smartPrompt,
                        maxTokens: 150
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Check if interview is complete
                if (interviewQuestionIndex >= 2) { // 3 questions total (0-2)
                    // Interview complete - show summary immediately
                    showInterviewSummary();
                } else {
                    // Add AI response and continue
                    addInterviewMessage(data.response, false);
                    interviewQuestionIndex++;
                }
                
            } catch (error) {
                console.error('Error calling AI interviewer:', error);
                
                // Remove typing indicator
                const typingIndicator = document.getElementById('interviewTypingIndicator');
                if (typingIndicator) typingIndicator.remove();
                
                // Fallback to static questions
                if (interviewQuestionIndex < interviewQuestions.length) {
                    addInterviewMessage(interviewQuestions[interviewQuestionIndex], false);
                    interviewQuestionIndex++;
                } else {
                    showInterviewSummary();
                }
            }
        }

        function showInterviewSummary() {
            // Hide interview interface
            document.getElementById('interview').classList.add('hidden');
            
            // Show summary
            const summary = document.getElementById('interviewSummary');
            summary.classList.remove('hidden');
            
            // Get document insights
            const documentInsights = window.documentInsights || {};
            const hasDocuments = uploadedFileContents.length > 0;
            
            // Populate summary content
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = `
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">Company Info</h4>
                        <p class="text-sm text-gray-600">Name: ${document.getElementById('companyName').value || 'Not specified'}</p>
                        <p class="text-sm text-gray-600">Size: ${document.getElementById('companySize').value || 'Not specified'}</p>
                        <p class="text-sm text-gray-600">Industry: ${document.getElementById('companyIndustry').value || 'Not specified'}</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">Documents</h4>
                        <p class="text-sm text-gray-600">${uploadedFileContents.length} file(s) uploaded</p>
                        ${hasDocuments ? '<p class="text-xs text-green-600 mt-1">‚úì Documents analyzed by AI</p>' : ''}
                    </div>
                </div>
                
                ${hasDocuments ? `
                <div class="bg-white p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-800 mb-2">üìÑ From Your Documents</h4>
                    <div class="grid md:grid-cols-2 gap-3 text-sm">
                        ${Object.entries(documentInsights).map(([key, value]) => {
                            if (value.includes('Found:')) {
                                return `<div class="text-green-700">‚úì ${key.charAt(0).toUpperCase() + key.slice(1)}: ${value.split('Found:')[1].split('|')[0].trim()}</div>`;
                            } else {
                                return `<div class="text-gray-600">? ${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}</div>`;
                            }
                        }).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div class="bg-white p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-800 mb-2">üéØ Interview Insights</h4>
                    <p class="text-sm text-gray-600">‚úì Company culture & values</p>
                    <p class="text-sm text-gray-600">‚úì Work style & priorities</p>
                    <p class="text-sm text-gray-600">‚úì Key advice for new hires</p>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-800 mb-2">üß† Smart Interview Benefits</h4>
                    <p class="text-sm text-blue-700">
                        ${hasDocuments ? 
                            '‚Ä¢ AI analyzed your documents first to avoid redundant questions<br>' +
                            '‚Ä¢ Interview focused only on gaps and unclear areas<br>' +
                            '‚Ä¢ More efficient and personalized experience' :
                            '‚Ä¢ Traditional interview approach to capture your culture<br>' +
                            '‚Ä¢ All insights captured through conversation'
                        }
                    </p>
                </div>
            `;
        }

        function addInterviewMessage(text, isUser) {
            const messagesContainer = document.getElementById('interviewMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} chat-message`;
            
            messageDiv.innerHTML = `
                <div class="max-w-lg">
                    ${!isUser ? `
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                <span>ü§ñ</span>
                            </div>
                            <span class="text-sm font-medium">AI Interviewer</span>
                        </div>
                    ` : ''}
                    <div class="rounded-2xl px-4 py-3 ${isUser ? 'bg-black text-white ml-12' : 'bg-white border border-gray-200 mr-12'}">
                        <p class="${isUser ? 'text-white' : 'text-gray-800'}">${text}</p>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function selectAgent(agentId) {
            currentAgent = agentId;
            const agent = agents[agentId];
            
            // Update UI
            document.getElementById('currentAgentAvatar').textContent = agent.avatar;
            document.getElementById('currentAgentName').textContent = agent.name;
            document.getElementById('currentAgentRole').textContent = agent.role;
            
            // Update active agent styling
            document.querySelectorAll('.agent-item').forEach(item => {
                item.classList.remove('bg-blue-50', 'border-blue-200');
            });
            document.querySelector(`[data-agent="${agentId}"]`).classList.add('bg-blue-50', 'border-blue-200');
            
            // Add agent greeting message
            addChatMessage(agent.greeting, false);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addChatMessage(message, true);
            input.value = '';

            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'flex justify-start chat-message';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="max-w-lg">
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-sm font-medium">${agents[currentAgent].name}</span>
                        <span class="text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-800">${agents[currentAgent].role}</span>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-2xl px-4 py-3 mr-12">
                        <p class="text-gray-800">Typing...</p>
                    </div>
                </div>
            `;
            document.getElementById('chatMessages').appendChild(typingDiv);
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollTop;

            // Call the real AI API
            callAIAgent(message, currentAgent);
        }

        async function callAIAgent(message, agentId) {
            try {
                // Remove typing indicator
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) typingIndicator.remove();

                // Prepare context for the AI
                const companyContext = {
                    name: document.getElementById('companyName').value || 'Your Company',
                    size: document.getElementById('companySize').value || 'Not specified',
                    industry: document.getElementById('companyIndustry').value || 'Not specified',
                    culture: window.interviewAnswers || [],
                    documents: uploadedFileContents.map(f => f.name)
                };

                const response = await fetch('/api/ai-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        agent: agentId,
                        context: companyContext
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Add AI response
                addChatMessage(data.response, false);
                
            } catch (error) {
                console.error('Error calling AI agent:', error);
                
                // Remove typing indicator
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) typingIndicator.remove();
                
                // Show fallback response
                const fallbackResponses = {
                    maya: "I'm having trouble connecting to my AI brain right now, but I'd be happy to help you with general onboarding questions! What would you like to know about getting started?",
                    alex: "I'm experiencing a technical issue, but I can still help with basic HR questions. What do you need assistance with?",
                    jordan: "I'm having a moment, but I'd love to tell you about company culture! What would you like to know?",
                    sam: "I'm having some tech difficulties, but I can still help with basic setup questions. What do you need help with?"
                };
                addChatMessage(fallbackResponses[agentId], false);
            }
        }

        function addChatMessage(text, isUser) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} chat-message`;
            
            messageDiv.innerHTML = `
                <div class="max-w-lg">
                    ${!isUser ? `
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm font-medium">${agents[currentAgent].name}</span>
                            <span class="text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-800">${agents[currentAgent].role}</span>
                        </div>
                    ` : ''}
                    <div class="rounded-2xl px-4 py-3 ${isUser ? 'bg-black text-white ml-12' : 'bg-white border border-gray-200 mr-12'}">
                        <p class="${isUser ? 'text-white' : 'text-gray-800'}">${text}</p>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function resetInterview() {
            interviewQuestionIndex = 0;
            document.getElementById('interview').classList.remove('hidden');
            document.getElementById('interviewSummary').classList.add('hidden');
            document.getElementById('interviewMessages').innerHTML = `
                <div class="flex justify-start">
                    <div class="max-w-lg">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                <span>ü§ñ</span>
                            </div>
                            <span class="text-sm font-medium">AI Interviewer</span>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-2xl px-4 py-3 mr-12">
                            <p class="text-gray-800">
                                Welcome! I'm your AI interviewer. I'll help capture what makes your company special. 
                                Let's start with something simple - how would you describe your company culture in a few words?
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function testFileUpload() {
            document.getElementById('fileInput').click();
            console.log('File input clicked!');
        }

        // Initialize the app and event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Onbora app loaded successfully!');
            showView('landing');
            
            document.querySelector('[data-agent="maya"]').classList.add('bg-blue-50', 'border-blue-200');

            // --- Proven File Upload Listeners ---
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');

            if (dropZone && fileInput) {
                dropZone.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => handleFileUpload(e.target.files));

                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                    }, false);
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.add('border-blue-400', 'bg-blue-50'), false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.remove('border-blue-400', 'bg-blue-50'), false);
                });

                dropZone.addEventListener('drop', (e) => handleFileUpload(e.dataTransfer.files), false);
            } else {
                console.error('File upload UI elements (dropZone or fileInput) not found.');
            }
        });
    </script>
</body>
</html>